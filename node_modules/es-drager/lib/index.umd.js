(function(Y,s){typeof exports=="object"&&typeof module<"u"?s(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],s):(Y=typeof globalThis<"u"?globalThis:Y||self,s(Y.ESDrager={},Y.Vue))})(this,function(Y,s){"use strict";const ie={tag:{type:[String,Object],default:"div"},resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:Number,default:0},height:{type:Number,default:0},left:{type:Number,default:0},top:{type:Number,default:0},zIndex:{type:Number,default:0},angle:{type:Number,default:0},color:{type:String,default:"#3a7afe"},minWidth:{type:Number,default:-1/0},minHeight:{type:Number,default:-1/0},maxWidth:{type:Number,default:0},maxHeight:{type:Number,default:0},aspectRatio:{type:Number},selected:Boolean,snapToGrid:Boolean,gridX:{type:Number,default:50},gridY:{type:Number,default:50},scaleRatio:{type:Number,default:1},disabledKeyEvent:Boolean,border:{type:Boolean,default:!0},resizeList:{type:Array},equalProportion:{type:Boolean},checkCollision:{type:Boolean}};function K(o,n){const e=t=>{n&&n(t),document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",e),document.removeEventListener("mouseleave",e),document.removeEventListener("touchmove",o),document.removeEventListener("touchend",e)};document.addEventListener("mousemove",o),document.addEventListener("mouseup",e),document.addEventListener("mouseleave",e),document.addEventListener("touchmove",o),document.addEventListener("touchend",e)}function S(o){let n=0,e=0;if(ae(o)){const t=o.targetTouches[0];n=t.pageX,e=t.pageY}else n=o.clientX,e=o.clientY;return{clientX:n,clientY:e}}function ae(o){const n=Object.prototype.toString.call(o);return n.substring(8,n.length-1)==="TouchEvent"}const T=(o=0)=>parseInt(o+"")+"px",O={n:"top",s:"bottom",e:"right",w:"left",ne:"top-right",nw:"top-left",se:"bottom-right",sw:"bottom-left"},q=["n","ne","e","se","s","sw","w","nw"],re={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7},le={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},ce=(o,n)=>{const e=le[Math.floor(o/30)],i=(re[n]+e)%8;return q[i]},J=(o=0,n)=>{let e=[];for(let t=0;t<q.length;t++){const i=q[t],[u,l]=O[i].split("-"),f=ce(o,i),d={[u]:"0%",cursor:f+"-resize",side:O[i]};if(l)d[l]="0%";else{const w=["top","bottom"].includes(u)?"left":"top";d[w]="50%"}n?n.includes(O[i])&&e.push(d):e.push(d)}return e},F=o=>o*Math.PI/180,ue=(o,n)=>Math.sqrt(o*o+n*n),v=o=>Math.cos(F(o)),M=o=>Math.sin(F(o)),de=(o,n,e,t,i,u,l)=>{let{width:f,height:d,centerX:w,centerY:b,rotateAngle:c}=n;const R=f<0?-1:1,g=d<0?-1:1;switch(f=Math.abs(f),d=Math.abs(d),o){case"right":{const r=_(f,e,u);f=r.width,e=r.deltaW,i?(t=e/i,d=f/i,w+=e/2*v(c)-t/2*M(c),b+=e/2*M(c)+t/2*v(c)):(w+=e/2*v(c),b+=e/2*M(c));break}case"top-right":{t=-t;const r=_(f,e,u);f=r.width,e=r.deltaW;const h=N(d,t,l);d=h.height,t=h.deltaH,i&&(e=t*i,f=d*i),w+=e/2*v(c)+t/2*M(c),b+=e/2*M(c)-t/2*v(c);break}case"bottom-right":{const r=_(f,e,u);f=r.width,e=r.deltaW;const h=N(d,t,l);d=h.height,t=h.deltaH,i&&(e=t*i,f=d*i),w+=e/2*v(c)-t/2*M(c),b+=e/2*M(c)+t/2*v(c);break}case"bottom":{const r=N(d,t,l);d=r.height,t=r.deltaH,i?(e=t*i,f=d*i,w+=e/2*v(c)-t/2*M(c),b+=e/2*M(c)+t/2*v(c)):(w-=t/2*M(c),b+=t/2*v(c));break}case"bottom-left":{e=-e;const r=_(f,e,u);f=r.width,e=r.deltaW;const h=N(d,t,l);d=h.height,t=h.deltaH,i&&(d=f/i,t=e/i),w-=e/2*v(c)+t/2*M(c),b-=e/2*M(c)-t/2*v(c);break}case"left":{e=-e;const r=_(f,e,u);f=r.width,e=r.deltaW,i?(d=f/i,t=e/i,w-=e/2*v(c)+t/2*M(c),b-=e/2*M(c)-t/2*v(c)):(w-=e/2*v(c),b-=e/2*M(c));break}case"top-left":{e=-e,t=-t;const r=_(f,e,u);f=r.width,e=r.deltaW;const h=N(d,t,l);d=h.height,t=h.deltaH,i&&(f=d*i,e=t*i),w-=e/2*v(c)-t/2*M(c),b-=e/2*M(c)+t/2*v(c);break}case"top":{t=-t;const r=N(d,t,l);d=r.height,t=r.deltaH,i?(f=d*i,e=t*i,w+=e/2*v(c)+t/2*M(c),b+=e/2*M(c)-t/2*v(c)):(w+=t/2*M(c),b-=t/2*v(c));break}}return{position:{centerX:w,centerY:b},size:{width:f*R,height:d*g}}},N=(o,n,e)=>{const t=o+n;return t>e?o=t:(n=e-o,o=e),{height:o,deltaH:n}},_=(o,n,e)=>{const t=o+n;return t>e?o=t:(n=e-o,o=e),{width:o,deltaW:n}},he=({centerX:o,centerY:n,width:e,height:t,angle:i})=>({top:n-t/2,left:o-e/2,width:e,height:t,angle:i}),fe=(o,n,e)=>{const{width:t,height:i}=o;return{width:Math.abs(t),height:Math.abs(i),left:n-Math.abs(t)/2,top:e-Math.abs(i)/2}};function V(o,n){const e=Math.abs(o)%n,t=o>0?n:-n;let i=0;return e>n/2?i=t*Math.ceil(Math.abs(o)/n):i=t*Math.floor(Math.abs(o)/n),i}function ge(o,n){if(!o||!n)return!1;const e=o.getBoundingClientRect(),t=n.getBoundingClientRect();return e.left<t.left+t.width&&e.left+e.width>t.left&&e.top<t.top+t.height&&e.top+e.height>t.top}function me(o,n,e){const t=s.ref(!1),i=s.ref(!1),u=s.ref({width:n.width,height:n.height,left:n.left,top:n.top,angle:n.angle}),l=new Set;function f(g){if(l.add(g.button),n.disabled)return;t.value=!0,i.value=!0;let{clientX:r,clientY:h}=S(g);const{left:y,top:k}=u.value;let a=0,m=0,p=0,E=0;n.boundary&&([a,m,p,E]=d()),e&&e("drag-start",u.value),K(D=>{if(l.size>1)return;const{clientX:X,clientY:z}=S(D);let A=(X-r)/n.scaleRatio+y,L=(z-h)/n.scaleRatio+k;if(n.snapToGrid){let{left:I,top:$}=u.value;const x=A-I,U=L-$;A=I+V(x,n.gridX),L=$+V(U,n.gridY)}n.boundary&&([A,L]=w(A,L,a,m,p,E)),u.value.left=A,u.value.top=L,e&&e("drag",u.value)},D=>{n.checkCollision&&b()&&(u.value.top=k,u.value.left=y),l.clear(),t.value=!1,document.addEventListener("click",c,{once:!0}),e&&e("drag-end",u.value)})}const d=()=>{let g=0,r=0;const{left:h,top:y,height:k,width:a,angle:m}=u.value,E=(o.value.parentElement||document.body).getBoundingClientRect();if(m&&n.scaleRatio===1){const X=o.value.getBoundingClientRect();g=Math.abs(X.left-(h+E.left)),r=Math.abs(X.top-(y+E.top))}const B=E.width/n.scaleRatio-a,D=E.height/n.scaleRatio-k;return[g,B-g,r,D-r,E.width/n.scaleRatio,E.height/n.scaleRatio]},w=(g,r,h,y,k,a)=>(g=g<h?h:g,g=g>y?y:g,r=r<k?k:r,r=r>a?a:r,[g,r]),b=()=>{const g=o.value.parentElement||document.body,r=Array.from(g.children).filter(h=>h!==o.value&&h.classList.contains("es-drager"));for(let h=0;h<r.length;h++){const y=r[h];if(ge(o.value,y))return!0}},c=()=>{i.value=!1},R=g=>{if(t.value)return;let{left:r,top:h}=u.value;if(["ArrowRight","ArrowLeft"].includes(g.key)){const y=g.key==="ArrowRight";let k=y?1:-1;n.snapToGrid&&(k=y?n.gridX:-n.gridX),r=r+k}else if(["ArrowUp","ArrowDown"].includes(g.key)){const y=g.key==="ArrowDown";let k=y?1:-1;n.snapToGrid&&(k=y?n.gridY:-n.gridY),h=h+k}if(n.boundary){const[y,k,a,m]=d();[r,h]=w(r,h,y,k,a,m)}u.value.left=r,u.value.top=h,e("change",{...u.value})};return s.onMounted(()=>{if(o.value){if(!u.value.width&&!u.value.height){const{width:g,height:r}=o.value.getBoundingClientRect();u.value={...u.value,width:g||100,height:r||100},e("change",{...u.value})}o.value.addEventListener("mousedown",f),o.value.addEventListener("touchstart",f,{passive:!0})}}),s.watch(i,g=>{n.disabledKeyEvent||(g?document.addEventListener("keydown",R):document.removeEventListener("keydown",R))}),s.onBeforeUnmount(()=>{document.removeEventListener("keydown",R)}),{isMousedown:t,selected:i,dragData:u,getBoundary:d,checkDragerCollision:b}}const pe=s.createElementVNode("div",{class:"es-drager-rotate-handle"},[s.createElementVNode("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[s.createElementVNode("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})])],-1),we=s.defineComponent({__name:"rotate",props:{modelValue:{type:Number,default:0},element:{type:Object}},emits:["update:modelValue","rotate","rotate-start","rotate-end"],setup(o,{emit:n}){const e=o,t=s.ref(null),i=s.computed({get:()=>e.modelValue,set:l=>{n("update:modelValue",l)}});function u(l){if(!e.element)return console.warn("[es-drager] rotate component need drag element property");l.stopPropagation();const{width:f,height:d,left:w,top:b}=e.element.getBoundingClientRect(),c=w+f/2,R=b+d/2;n("rotate-start",i.value),K(g=>{const{clientX:r,clientY:h}=S(g),y=c-r,k=R-h,m=Math.atan2(k,y)*180/Math.PI-90;i.value=(m+360)%360,n("rotate",i.value)},()=>{n("rotate-end",i.value)})}return(l,f)=>(s.openBlock(),s.createElementBlock("div",{ref_key:"rotateRef",ref:t,class:"es-drager-rotate",onMousedown:u,onTouchstartPassive:u},[s.renderSlot(l.$slots,"default",{},()=>[pe])],544))}}),xe="",ye=["data-side","onMousedown","onTouchstartPassive"],be=s.createElementVNode("div",{class:"es-drager-dot-handle"},null,-1),P=s.defineComponent({__name:"drager",props:ie,emits:["change","drag","drag-start","drag-end","resize","resize-start","resize-end","rotate","rotate-start","rotate-end"],setup(o,{emit:n}){const e=o,t=(a,...m)=>{n(a,...m),n("change",...m)},i=s.ref(null),{selected:u,dragData:l,isMousedown:f,getBoundary:d,checkDragerCollision:w}=me(i,e,t),b=s.ref(J(0,e.resizeList)),c=s.computed(()=>e.resizable&&!e.disabled),R=s.computed(()=>e.rotatable&&!e.disabled&&u.value),g=s.computed(()=>{const{width:a,height:m,left:p,top:E,angle:B}=l.value,D={};return a&&(D.width=T(a)),m&&(D.height=T(m)),{...D,left:T(p),top:T(E),zIndex:e.zIndex,transform:`rotate(${B}deg)`,"--es-drager-color":e.color}});function r(a){i.value||(i.value=a.$el||a)}function h(a){b.value=J(a,e.resizeList),t("rotate-end",l.value)}function y(a,m){if(e.disabled)return;m.stopPropagation();const{clientX:p,clientY:E}=S(m),B=p,D=E,{width:X,height:z,left:A,top:L}=l.value,I=A+X/2,$=L+z/2,x={width:X,height:z,centerX:I,centerY:$,rotateAngle:l.value.angle},U=a.side,{minWidth:ve,minHeight:Me,aspectRatio:Z,equalProportion:ke}=e;t("resize-start",l.value);let H=[];e.boundary&&(H=d()),K(W=>{const{clientX:Ee,clientY:Be}=S(W);let G=(Ee-B)/e.scaleRatio,j=(Be-D)/e.scaleRatio;e.snapToGrid&&(G=V(G,e.gridX),j=V(j,e.gridY));const De=Math.atan2(j,G),ee=ue(G,j),Ae=W.shiftKey,te=De-F(x.rotateAngle),Xe=ee*Math.cos(te),Ye=ee*Math.sin(te),ne=(ke||Ae)&&!Z?x.width/x.height:Z,{position:{centerX:oe,centerY:se},size:{width:Re,height:ze}}=de(U,{...x,rotateAngle:x.rotateAngle},Xe,Ye,ne,ve,Me),Le=he({centerX:oe,centerY:se,width:Re,height:ze,angle:l.value.angle});let C={...l.value,...fe(Le,oe,se)};e.maxWidth>0&&(C.width=Math.min(C.width,e.maxWidth)),e.maxHeight>0&&(C.height=Math.min(C.height,e.maxHeight)),e.boundary&&(C=k(C,H,ne)),l.value=C,t("resize",l.value)},()=>{e.checkCollision&&w()&&(l.value={...l.value,width:X,height:z,left:A,top:L}),t("resize-end",l.value)})}function k(a,m,p){const[E,B,D,X,z,A]=m;return a.left<E&&(a.left=E,a.width=l.value.width,p&&(a.height=l.value.height)),a.left+a.width>z&&(a.left=l.value.left,a.width=z-a.left,p&&(a.height=l.value.height)),a.top<D&&(a.top=D,a.height=l.value.height,p&&(a.width=l.value.width)),a.top+a.height>A&&(a.top=l.value.top,a.height=A-a.top,p&&(a.width=l.value.width)),a}return s.watch(()=>[e.width,e.height,e.left,e.top,e.angle],([a,m,p,E,B])=>{l.value={...l.value,width:a,height:m,left:p,top:E,angle:B}}),s.watch(()=>e.selected,a=>{u.value=a},{immediate:!0}),(a,m)=>(s.openBlock(),s.createBlock(s.resolveDynamicComponent(a.tag),{ref:r,class:s.normalizeClass(["es-drager",{disabled:a.disabled,dragging:s.unref(f),selected:s.unref(u),border:a.border}]),style:s.normalizeStyle(g.value),onClick:m[3]||(m[3]=s.withModifiers(()=>{},["stop"]))},{default:s.withCtx(()=>[s.renderSlot(a.$slots,"default"),c.value?(s.openBlock(!0),s.createElementBlock(s.Fragment,{key:0},s.renderList(b.value,(p,E)=>(s.openBlock(),s.createElementBlock("div",{key:E,class:"es-drager-dot","data-side":p.side,style:s.normalizeStyle({...p}),onMousedown:B=>y(p,B),onTouchstartPassive:B=>y(p,B)},[s.renderSlot(a.$slots,"resize",s.normalizeProps(s.guardReactiveProps({side:p.side})),()=>[be])],44,ye))),128)):s.createCommentVNode("",!0),R.value?(s.openBlock(),s.createBlock(we,{key:1,modelValue:s.unref(l).angle,"onUpdate:modelValue":m[0]||(m[0]=p=>s.unref(l).angle=p),element:i.value,onRotate:m[1]||(m[1]=p=>t("rotate",s.unref(l))),onRotateStart:m[2]||(m[2]=p=>t("rotate-start",s.unref(l))),onRotateEnd:h},{default:s.withCtx(()=>[s.renderSlot(a.$slots,"rotate")]),_:3},8,["modelValue","element"])):s.createCommentVNode("",!0)]),_:3},8,["class","style"]))}}),Ce="",Q=o=>{o.component("es-drager",P)};P.install=Q,Y.ESDrager=P,Y.default=P,Y.install=Q,Object.defineProperties(Y,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
